#!/usr/bin/env python
"""Listen on a UNIX domain socket to manage user SSH keys.
"""
import atexit
from os import remove
from SocketServer import UnixStreamServer

from keyholer import conf
from keyholer.keyholer_daemon import KeyholerDaemon


@atexit.register
def cleanup_socket():
    """Removes the keyholer socket.
    """
    remove(conf['socket'])


if __name__ == "__main__":
    # Create the server, listening on a unix domain socket
    server = UnixStreamServer(conf['socket'], KeyholerDaemon)
    server.serve_forever()
